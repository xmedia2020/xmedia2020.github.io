<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>P1</title>
</head>
<body>
    <audio src="commento.mp3"></audio>
    <canvas style="background-color:gray;width:512px; height:256px;"></canvas>
    <button>BUTTON</button>
    <script type="text/javascript">

        const sound = document.querySelector("audio")
        const audio_ctx = new (window.AudioContext || window.webkitAudioContext)()
        const analyser = audio_ctx.createAnalyser()
        analyser.fftSize = 256

        const audio_src = audio_ctx.createMediaElementSource(sound)
        analyser.connect(audio_ctx.destination)
        audio_src.connect(analyser)

        document.querySelector("button").onclick = function(){
            sound.play()
        }

        const canvas = document.querySelector('canvas')
        const ctx = canvas.getContext("2d")

        let data = new Uint8Array(analyser.frequencyBinCount)

        function render() {
            analyser.getByteTimeDomainData(data)
            ctx.clearRect(0, 0, canvas.width, canvas.height)
            for (let i=0; i<data.length; i++) {
                ctx.fillStyle = "black";
                ctx.fillRect(i, 0, 1, data[i]);
            }
            requestAnimationFrame(render);
        }
        requestAnimationFrame(render);

    </script>
</body>
</html>